# 機能一覧

## 1. ユーザー操作機能

### 1.1 企業要約入力機能
#### F001: 基準企業入力
- **説明**: 比較の基準となる企業の情報を入力
- **操作**: 企業名 + 要約テキストを入力
- **バリデーション**: 必須入力チェック
- **実装**: `SummaryInputTab.tsx`, `CompanyInput.tsx`

#### F002: 比較企業入力
- **説明**: 比較対象企業の情報を入力（1〜4社）
- **操作**: 企業名 + 要約テキストを入力
- **動作**: 動的に企業を追加・削除可能
- **実装**: `CompanyInput.tsx`, `AddCompanyButton.tsx`

#### F003: 企業追加・削除
- **説明**: 比較企業の追加・削除
- **制限**: 最大4社まで追加可能
- **操作**: [+企業追加]ボタン、[×削除]ボタン
- **実装**: `useCompanies.ts`

### 1.2 プロンプト管理機能
#### F004: プロンプト入力・編集
- **説明**: 比較分析用プロンプトの入力・編集
- **機能**: 
  - テキストエリアでの編集
  - 動的参照 `{基準企業}`, `{比較企業1}`等
  - リアルタイムプレビュー（Phase 2）
- **実装**: `PromptEditor.tsx`

#### F005: プロンプト保存 (Phase 2)
- **説明**: 作成したプロンプトを名前付きで保存
- **操作**: プロンプト名入力 + [保存]ボタン
- **保存先**: ローカルストレージ
- **実装**: `usePrompts.ts`, `PromptActions.tsx`

#### F006: プロンプト読み込み (Phase 2)
- **説明**: 保存済みプロンプトの読み込み
- **操作**: ドロップダウンから選択
- **機能**: プロンプト一覧表示、選択時の自動読み込み
- **実装**: `PromptSelector.tsx`

#### F007: プロンプト削除 (Phase 2)
- **説明**: 保存済みプロンプトの削除
- **操作**: [削除]ボタン + 確認ダイアログ
- **実装**: `ConfirmDialog.tsx`, `PromptActions.tsx`

### 1.3 LLM実行機能
#### F008: LLM選択
- **説明**: 使用するLLMモデルの選択
- **対応モデル**: Azure OpenAI (GPT-4o, GPT-4o Mini, GPT-4.1 Mini), Gemini (2.0 Flash, 1.5 Pro)
- **操作**: ヘッダーのドロップダウンから選択
- **実装**: `Header.tsx`, `useLLM.ts`

#### F009: 分析実行
- **説明**: プロンプトと企業要約を使用した比較分析実行
- **前提条件**: 基準企業 + 1社以上の比較企業 + プロンプト
- **処理**: 
  1. 動的参照の置換
  2. LLM API呼び出し
  3. 結果表示タブへ自動遷移
- **実装**: `useLLM.ts`, `PromptActions.tsx`

### 1.4 結果表示機能
#### F010: 分析結果表示
- **説明**: LLMによる比較分析結果の表示
- **表示内容**: 
  - 実行情報（使用LLM、プロンプト名）
  - 分析結果テキスト
  - 使用量情報（トークン数、推定料金）
- **実装**: `ResultTab.tsx`, `ResultDisplay.tsx`

#### F011: 結果コピー
- **説明**: 分析結果をクリップボードにコピー
- **操作**: [結果をコピー]ボタン
- **フィードバック**: コピー完了通知
- **実装**: `useClipboard.ts`, `ResultActions.tsx`

#### F012: 再実行
- **説明**: 同じ条件で分析を再実行
- **操作**: [再実行]ボタン
- **処理**: F009と同じ処理を再実行
- **実装**: `ResultActions.tsx`

## 2. システム機能

### 2.1 データ管理機能
#### S001: 状態管理
- **説明**: アプリケーション全体の状態管理
- **管理対象**: 
  - 現在のタブ
  - 企業データ
  - プロンプトデータ
  - 実行結果
- **実装**: React useState, カスタムフック

#### S002: ローカルストレージ管理
- **説明**: プロンプトデータの永続化
- **保存データ**: 
  - 保存済みプロンプト一覧
  - LLM設定（Phase 2）
- **実装**: `useLocalStorage.ts`

#### S003: バリデーション
- **説明**: 入力データの妥当性チェック
- **チェック項目**: 
  - 必須項目入力チェック
  - 文字数制限チェック
  - プロンプト名重複チェック
- **実装**: 各コンポーネント内

### 2.2 API連携機能
#### S004: LLM API連携
- **説明**: Azure OpenAI と Gemini API との連携
- **エンドポイント**: `/api/analyze`
- **機能**: 
  - 複数LLMプロバイダー対応
  - 統一されたレスポンス形式
  - エラーハンドリング
  - 認証方式の自動選択
- **実装**: `src/app/api/analyze/route.ts`, `src/utils/llm-clients.ts`

#### S005: トークン計算 (Phase 2)
- **説明**: 入力・出力トークン数の計算
- **使用ライブラリ**: tiktoken等
- **実装**: トークン計算ユーティリティ

#### S006: 料金計算 (Phase 2)
- **説明**: LLM使用料金の推定計算
- **計算方式**: トークン数 × モデル別単価
- **実装**: 料金計算ユーティリティ

### 2.3 UI/UX機能
#### S007: タブ切り替え
- **説明**: 3つのタブ間の切り替え機能
- **状態保持**: タブ切り替え時の入力内容保持
- **実装**: `useTabState.ts`

#### S008: レスポンシブ対応 (Phase 3)
- **説明**: モバイル・タブレット対応
- **ブレークポイント**: Tailwind CSS標準
- **実装**: Tailwind CSS レスポンシブクラス

#### S009: ローディング表示
- **説明**: API実行中のローディング表示
- **表示タイミング**: LLM実行中
- **実装**: `Loading.tsx`

#### S010: エラー表示
- **説明**: エラー発生時の表示
- **エラー種類**: 
  - バリデーションエラー
  - API エラー
  - ネットワークエラー
- **実装**: `Toast.tsx`, エラーバウンダリ

## 3. 設定管理機能 (Phase 2)

### 3.1 LLM設定
#### C001: 環境変数管理
- **変数**: API Key、Endpoint等の秘密情報
- **管理**: `.env.local`
- **実装**: Next.js環境変数機能

#### C002: LLM設定の動的管理
- **内容**: 各LLMの設定情報をコード内で定義
- **機能**: 利用可能なLLMの自動検出
- **実装**: `src/types/index.ts`, `src/utils/llm-clients.ts`

## 4. 実装優先度

### Phase 1 (MVP)
- [x] F001, F002, F003: 企業要約入力
- [ ] F004: 基本的なプロンプト入力
- [ ] F008, F009: LLM選択・実行（Azure OpenAI + Gemini対応）
- [ ] F010: 基本的な結果表示
- [ ] S001, S003, S007: 基本的な状態管理
- [ ] S004: LLM API連携
- [ ] S009: ローディング表示

### Phase 2
- [ ] F005, F006, F007: プロンプト管理機能
- [ ] F011, F012: 結果操作機能
- [ ] S002: ローカルストレージ管理
- [ ] S005, S006: トークン・料金計算
- [ ] C001, C002: 設定管理

### Phase 3
- [ ] S008: レスポンシブ対応
- [ ] S010: 高度なエラーハンドリング
- [ ] UI/UX改善
- [ ] パフォーマンス最適化
