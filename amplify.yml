version: 1
frontend:
  phases:
    preBuild:
      commands:
        # 環境変数の確認（デバッグ用）
        - echo "AZURE_OPENAI_TARGET_URI=$AZURE_OPENAI_TARGET_URI"
        - echo "AZURE_OPENAI_TARGET_KEY=$AZURE_OPENAI_TARGET_KEY"
        - echo "AZURE_OPENAI_API_VERSION=$AZURE_OPENAI_API_VERSION"
        - echo "AZURE_OPENAI_GPT4O_DEPLOYMENT=$AZURE_OPENAI_GPT4O_DEPLOYMENT"
        - echo "AZURE_OPENAI_GPT4O_MINI_DEPLOYMENT=$AZURE_OPENAI_GPT4O_MINI_DEPLOYMENT"
        - echo "AZURE_OPENAI_GPT41_MINI_DEPLOYMENT=$AZURE_OPENAI_GPT41_MINI_DEPLOYMENT"
        - echo "GEMINI_API_KEY=$GEMINI_API_KEY"
        # 環境変数を.envファイルに書き出し（確実な反映のため）
        - echo "AZURE_OPENAI_TARGET_URI=$AZURE_OPENAI_TARGET_URI" >> .env
        - echo "AZURE_OPENAI_TARGET_KEY=$AZURE_OPENAI_TARGET_KEY" >> .env
        - echo "AZURE_OPENAI_API_VERSION=$AZURE_OPENAI_API_VERSION" >> .env
        - echo "AZURE_OPENAI_GPT4O_DEPLOYMENT=$AZURE_OPENAI_GPT4O_DEPLOYMENT" >> .env
        - echo "AZURE_OPENAI_GPT4O_MINI_DEPLOYMENT=$AZURE_OPENAI_GPT4O_MINI_DEPLOYMENT" >> .env
        - echo "AZURE_OPENAI_GPT41_MINI_DEPLOYMENT=$AZURE_OPENAI_GPT41_MINI_DEPLOYMENT" >> .env
        - echo "GEMINI_API_KEY=$GEMINI_API_KEY" >> .env
        # Next.js 設定
        - echo "NEXT_PUBLIC_APP_NAME=$NEXT_PUBLIC_APP_NAME"
        - echo "NEXT_PUBLIC_APP_VERSION=$NEXT_PUBLIC_APP_VERSION"
        - npm ci
    build:
      commands:
        - npm run build
  artifacts:
    baseDirectory: .next
    files:
      - '**/*'
  cache:
    paths:
      - node_modules/**/*
      - .next/cache/**/*
